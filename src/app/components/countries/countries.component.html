<div class="app-container">
  <!-- Header -->
  <header class="app-header">
    <div class="header-content">
      <h1 class="header-title">
        <mat-icon class="gradient-icon">public</mat-icon>
        Country Population Explorer
      </h1>
      <p class="header-subtitle">Discover population insights worldwide</p>
    </div>
  </header>

  <!-- Main Content -->
  <main class="app-main">
    <div class="content-grid">
      <!-- Left Section: Controls and Chart -->
      <section class="left-section">
        <div class="control-panel">
          <mat-form-field appearance="fill" class="custom-select">
            <mat-label>
              <mat-icon>flag_circle</mat-icon> Select a Country
            </mat-label>
            <mat-select
              [(value)]="selectedCountryCode"
              (selectionChange)="onCountrySelectionChange()"
              panelClass="custom-mat-select"
              aria-label="Select a country"
            >
              <mat-option value="" disabled>Choose a country</mat-option>
              <mat-option *ngFor="let country of countries" [value]="country.cca2">
                {{ country.name.common }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field
            appearance="fill"
            class="custom-select chart-type-select"
            *ngIf="selectedCountryCode"
          >
      <mat-label>
  <mat-icon>bar_chart</mat-icon> Chart Type
</mat-label>
<mat-select [(ngModel)]="chartType" 
           (selectionChange)="renderChart()" 
           [ngClass]="{'wide-select': chartType === 'bar'}">
  <mat-option value="bar" class="barc">Bar Chart</mat-option>
  <mat-option value="pie">Pie Chart</mat-option>
</mat-select>
          </mat-form-field>
        </div>

        <!-- Population Card (Reduced Size) -->
        <div
          class="population-card compact"
          *ngIf="countryPopulation !== undefined"
          @fadeIn
        >
          <div class="flag-container">
            <img
              *ngIf="getCountryInfo('flags')"
              [src]="getCountryInfo('flags')"
              alt="{{ selectedCountryName }} flag"
              class="country-flag"
            />
          </div>
          <div class="population-content">
            <h2 class="population-title">
              <mat-icon>groups</mat-icon> {{ selectedCountryName }}
            </h2>
            <p class="population-value">Population: <span>{{ countryPopulation | number }}</span></p>
          </div>
        </div>

        <!-- Error Message -->
        <div class="error-message" *ngIf="errorMessage">
          <mat-icon color="warn">error_outline</mat-icon>
          {{ errorMessage }}
          <button mat-flat-button color="accent" (click)="fetchCountryPopulation()">Retry</button>
        </div>

        <!-- Chart -->
        <div
          class="chart-wrapper"
          [ngClass]="{ 'chart-active': selectedCountryCode && chartType }"
        >
          <canvas id="myChart"></canvas>
        </div>
      </section>

      <!-- Right Section: Stats and Details -->
      <section class="right-section">
        <!-- Population Stats -->
        <div class="stats-grid">
          <div class="stats-card" @cardAnimation>
            <h2 class="stats-title">
              <mat-icon>arrow_circle_up</mat-icon> Highest Populations
            </h2>
            <div class="stats-list">
              <div
                *ngFor="let country of top5HighPopulation; let i = index"
                class="stats-item"
              >
                <span class="rank">{{ i + 1 }}</span>
                <span class="country-name">{{ country.name.common }}</span>
                <span class="population">{{ country.population | number }}</span>
              </div>
            </div>
          </div>

          <div class="stats-card" @cardAnimation>
            <h2 class="stats-title">
              <mat-icon>arrow_circle_down</mat-icon> Lowest Populations
            </h2>
            <div class="stats-list">
              <div
                *ngFor="let country of top5LowPopulation; let i = index"
                class="stats-item"
              >
                <span class="rank">{{ i + 1 }}</span>
                <span class="country-name">{{ country.name.common }}</span>
                <span class="population">{{ country.population | number }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Country Details -->
        <div class="details-card">
          <div class="details-header">
            <h2 class="details-title">
              <mat-icon>info_outline</mat-icon> Country Details
            </h2>
            <button
              mat-flat-button
              color="primary"
              (click)="openPopulationGraphModal()"
              class="graph-button"
              [ngClass]="{ 'blink': isGraphButtonBlinking }"
            >
              <mat-icon class="gradient-icon">insights</mat-icon>
              View Global Graph
            </button>
          </div>
          <div class="details-grid" *ngIf="selectedCountryCode" @fadeIn>
            <div class="detail-item">
              <mat-icon>square_foot</mat-icon>
              <span class="label">Area</span>
              <span class="value">{{ getCountryInfo('area') }} sq. km</span>
            </div>
            <div class="detail-item">
              <mat-icon>location_city</mat-icon>
              <span class="label">Capital</span>
              <span class="value">{{ getCountryInfo('capital') }}</span>
            </div>
            <div class="detail-item">
              <mat-icon>language</mat-icon>
              <span class="label">Languages</span>
              <span class="value">{{ getCountryInfo('languages') }}</span>
            </div>
            <div class="detail-item">
              <mat-icon>attach_money</mat-icon>
              <span class="label">Currency</span>
              <span class="value">{{ getCountryInfo('currencies') }}</span>
            </div>
            <div class="detail-item">
              <mat-icon>groups</mat-icon>
              <span class="label">Population</span>
              <span class="value">{{ getCountryInfo('population') | number }}</span>
            </div>
            <div class="detail-item">
              <mat-icon>map</mat-icon>
              <span class="label">Continent</span>
              <span class="value">{{ getCountryInfo('continents') }}</span>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Modal (Enlarged) -->
  <div
    class="modal-overlay"
    [ngClass]="{ open: isPopulationGraphModalOpen }"
    @modalAnimation
  >
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">
          <mat-icon>insights</mat-icon> Global Population Insights
        </h2>
        <button
          mat-icon-button
          class="close-button"
          (click)="closePopulationGraphModal()"
        >
          <mat-icon>close</mat-icon>
        </button>
      </div>
      <mat-form-field appearance="fill" class="custom-select">
        <mat-label>
          <mat-icon>bar_chart</mat-icon> Graph Type
        </mat-label>
        <mat-select
          [(value)]="modalChartType"
          (selectionChange)="renderPopulationChart()"
        >
          <mat-option value="bar">Bar</mat-option>
          <mat-option value="line">Line</mat-option>
          <mat-option value="polarArea">Polar Area</mat-option>
          <mat-option value="radar">Radar</mat-option>
          <mat-option value="doughnut">Doughnut</mat-option>
        </mat-select>
      </mat-form-field>
      <div class="modal-chart-wrapper">
        <canvas #populationChart></canvas>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoading">
    <mat-spinner diameter="50" color="primary"></mat-spinner>
    <p class="loading-text">Fetching data...</p>
  </div>
</div>